<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.buaa.markpp.dao.AccountDao">
    <select id="selectById" parameterType="int" resultType="Account">
        select * from account where account_id = #{id};
    </select>
    <select id="selectByUsername" parameterType="String" resultType="Account">
        select * from account where username = #{username};
    </select>
    <insert id="insert" parameterType="Account" useGeneratedKeys="true" keyProperty="accountId">
        insert into account(username, password) values (#{username}, #{password});
    </insert>
    <update id="update" parameterType="Account">
        update account
        <set>
            <if test="password != null">
                password = #{password},
            </if>
            email = #{email},
            nickname = #{nickname},
            avatar = #{avatar},
        </set>
        where account_id = #{accountId};
    </update>
    <select id="selectSortedByHeat" resultType="Account" parameterType="int">
        select a1.account_id, username, nickname, email, avatar from account as a1 join
                                                                           (select COUNT(*) follows, a.account_id account_id from
                                                                               follow join account a on follow.author_id = a.account_id group by a.account_id) as f1
                                                                           on a1.account_id = f1.account_id order by follows desc limit #{number}
    </select>
</mapper>
